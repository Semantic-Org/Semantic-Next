---
const { currentRoute, floating } = Astro.props;
let { showThemeSwitcher } = Astro.props;
import { Image } from 'astro:assets';

import logoImage from '@images/logo.png';
import MobileMenuToggle from '@components/MobileMenuToggle/MobileMenuToggle.js';
import GlobalSearch from '@components/GlobalSearch/GlobalSearch.js';
import TopbarMenu from '@components/TopbarMenu/TopbarMenu.js';
import ThemeSwitcher from '@components/ThemeSwitcher/ThemeSwitcher.js';

import { getTopbarMenu, removeTrailingSlash } from '@helpers/navigation.js';

const menu = await getTopbarMenu();
const activeURL = removeTrailingSlash(Astro.url.pathname);

showThemeSwitcher = (showThemeSwitcher === 'false') ? false : true;

import './TopBar.css';
---
<script>
  import { $ } from '@semantic-ui/query';
  let scrollingDown;
  let lastScrollPosition;
  $(window).on('scroll', function() {
    const isMobile = $(window).width() < 768;
    const scrollTop = $('html').scrollTop();
    scrollingDown = Boolean(scrollTop >= lastScrollPosition);
    lastScrollPosition = scrollTop;
    requestAnimationFrame(() => {
      if(isMobile && scrollingDown && scrollTop !== 0) {
        $('topbar').addClass('hidden');
      }
      else {
        $('topbar').removeClass('hidden');
      }
    });
  }, { passive: true });
</script>
<topbar class={floating ? 'floating' : 'fluid'} transition:persist>
  <div class="content">
    <span class="left">
      <a class="logo" href="/">
        <Image src={logoImage} alt="Logo" height="35" loading="eager"></Image>
        <span class="name">
          Semantic UI
        </span>
      </a>
    </span>
    <TopbarMenu
      client:load
      menu={menu}
      activeURL={activeURL}
    ></TopbarMenu>
    <GlobalSearch client:load></GlobalSearch>
    {showThemeSwitcher && (
      <ThemeSwitcher client:load transition:name="theme"></ThemeSwitcher>
    )}
    <MobileMenuToggle client:load></MobileMenuToggle>
  </div>
</topbar>
